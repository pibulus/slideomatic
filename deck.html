<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Slide-o-matic 🎬</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="preconnect"
      href="https://fonts.googleapis.com"
      crossorigin
    />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&family=Space+Mono:wght@400;700&family=Space+Grotesk:wght@400;600;700&family=JetBrains+Mono:wght@400;700&family=Press+Start+2P&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <input type="file" id="deck-upload" accept=".json" style="display: none;" />
    <div class="app" id="app">
      <div class="grain-overlay" aria-hidden="true"></div>

      <!-- Theme Editor Drawer (Left Side) -->
      <aside class="theme-drawer" id="theme-drawer">
        <div class="theme-drawer__header">
          <h2>🎨 Theme Editor</h2>
          <button class="theme-drawer__close" aria-label="Close theme editor">×</button>
        </div>
        <div class="theme-drawer__content">
          <div class="theme-drawer__actions">
            <button class="theme-drawer__btn theme-drawer__btn--primary" id="theme-save-btn">
              💾 Save to Library
            </button>
            <button class="theme-drawer__btn theme-drawer__btn--ai" id="theme-ai-btn">
              ✨ Ask AI
            </button>
            <button class="theme-drawer__btn theme-drawer__btn--random" id="theme-random-btn">
              🎲 Randomize
            </button>
          </div>

          <div class="theme-drawer__library">
            <h3>Saved Themes</h3>
            <div class="theme-drawer__library-list" id="theme-library-list">
              <!-- Saved themes will be populated here -->
            </div>
          </div>

          <div class="theme-drawer__editor">
            <h3>Current Theme JSON</h3>
            <textarea
              class="theme-drawer__textarea"
              id="theme-json-editor"
              spellcheck="false"
              placeholder='{"color-bg": "#fffbf3", ...}'
            ></textarea>
            <button class="theme-drawer__apply-btn" id="theme-apply-btn">
              Apply Changes
            </button>
          </div>
        </div>
      </aside>

      <!-- Slide Editor Drawer (Right Side) -->
      <aside class="edit-drawer" id="edit-drawer">
        <div class="edit-drawer__header">
          <h2>Edit Slide</h2>
          <button class="edit-drawer__close" aria-label="Close editor">×</button>
        </div>
        <div class="edit-drawer__content" id="edit-drawer-content">
          <!-- Form will be dynamically generated -->
        </div>
      </aside>

      <!-- Speaker Notes Modal -->
      <div class="notes-modal" id="notes-modal">
        <div class="notes-modal__backdrop"></div>
        <div class="notes-modal__content">
          <div class="notes-modal__header">
            <h2>📝 Speaker Notes</h2>
            <button class="notes-modal__close" aria-label="Close notes">×</button>
          </div>
          <div class="notes-modal__body">
            <div class="notes-modal__slide-title" id="notes-slide-title"></div>
            <div class="notes-modal__text" id="notes-text">
              No speaker notes for this slide.
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Modal -->
      <div class="settings-modal" id="settings-modal">
        <div class="settings-modal__backdrop"></div>
        <div class="settings-modal__content">
          <div class="settings-modal__header">
            <h2>⚙️ Settings</h2>
            <button class="settings-modal__close" aria-label="Close settings">×</button>
          </div>
          <div class="settings-modal__body">
            <div class="settings-field">
              <label class="settings-field__label" for="gemini-api-key">
                Gemini API Key
                <span class="settings-field__hint">Required for voice-to-slide and voice-to-theme</span>
              </label>
              <div class="settings-field__input-group">
                <input
                  type="password"
                  id="gemini-api-key"
                  class="settings-field__input"
                  placeholder="Enter your Gemini API key..."
                  autocomplete="off"
                />
                <button class="settings-field__toggle" id="toggle-api-key-visibility" aria-label="Toggle visibility">
                  👁️
                </button>
              </div>
              <div class="settings-field__actions">
                <button class="settings-btn settings-btn--primary" id="save-api-key">
                  Save Key
                </button>
                <button class="settings-btn settings-btn--secondary" id="test-api-key">
                  Test Connection
                </button>
                <button class="settings-btn settings-btn--danger" id="clear-api-key">
                  Clear Key
                </button>
              </div>
              <div class="settings-field__status" id="api-key-status"></div>
            </div>
            <div class="settings-help">
              <p><strong>Don't have an API key?</strong></p>
              <p>Get one free at <a href="https://makersuite.google.com/app/apikey" target="_blank" rel="noopener">Google AI Studio</a></p>
              <p class="settings-help__note">Your key is stored locally in your browser and never sent anywhere except Google's Gemini API.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Intro Modal (First Visit) -->
      <div class="intro-modal" id="intro-modal">
        <div class="intro-modal__backdrop"></div>
        <div class="intro-modal__content">
          <div class="intro-modal__header">
            <h2>🎬 Welcome to Slide-O-Matic</h2>
          </div>
          <div class="intro-modal__body">
            <div class="intro-modal__section">
              <h3>✨ Voice-Powered Presentations</h3>
              <p>Create slides by talking. Edit with natural language. Generate themes with AI.</p>
            </div>

            <div class="intro-modal__section">
              <h3>⌨️ Keyboard Shortcuts</h3>
              <ul class="intro-modal__shortcuts">
                <li><kbd>←</kbd> <kbd>→</kbd> Navigate slides</li>
                <li><kbd>V</kbd> Add slide with voice</li>
                <li><kbd>E</kbd> Edit current slide</li>
                <li><kbd>T</kbd> Open theme editor</li>
                <li><kbd>O</kbd> Overview mode</li>
                <li><kbd>N</kbd> Speaker notes</li>
                <li><kbd>S</kbd> Settings (API key)</li>
              </ul>
            </div>

            <div class="intro-modal__section">
              <h3>🎨 Three Ways to Theme</h3>
              <ul class="intro-modal__features">
                <li><strong>AI Generator:</strong> Describe your vibe, get a theme</li>
                <li><strong>Smart Randomizer:</strong> Color theory-based palettes</li>
                <li><strong>JSON Editor:</strong> Full manual control</li>
              </ul>
            </div>

            <div class="intro-modal__section intro-modal__section--highlight">
              <p>💡 <strong>Pro tip:</strong> Press <kbd>S</kbd> to add your Gemini API key for voice features</p>
            </div>
          </div>
          <div class="intro-modal__footer">
            <button class="intro-modal__btn intro-modal__btn--primary" id="intro-modal-close">
              Got it, let's go! 🚀
            </button>
          </div>
        </div>
      </div>

      <main class="slides" id="slides" aria-live="polite"></main>
      <footer class="hud">
        <div class="hud__controls">
          <button class="hud__action hud__add-btn" id="add-btn" aria-label="Add slide from voice (V)" title="Add slide from voice (V)">Add</button>
          <button class="hud__action hud__edit-btn" id="edit-btn" aria-label="Ask Gemini to edit current slide" title="Edit current slide with Gemini">Edit</button>
          <button class="hud__action hud__theme-btn" id="theme-btn" aria-label="Open theme editor" title="Open theme editor (T)">Theme</button>
          <button class="hud__action hud__overview-btn" id="overview-btn" aria-label="View all slides" title="View all slides">Overview</button>
          <button class="hud__action hud__save-btn" id="save-deck-btn" aria-label="Download slides JSON" title="Download slides JSON">Save</button>
          <select class="hud__theme-select" id="theme-select" aria-label="Switch theme" title="Switch theme">
            <option value="theme.json">Default</option>
            <option value="themes/vaporwave.json">Vaporwave</option>
            <option value="themes/slack.json">Slack</option>
            <option value="themes/gameboy.json">Gameboy</option>
          </select>
          <span class="hud__hint" title="Navigate slides">← / →</span>
          <div class="hud__status" id="hud-status"></div>
        </div>
        <div class="hud__counter">
          <span data-counter-current>1</span>
          <span class="hud__divider">/</span>
          <span data-counter-total>1</span>
        </div>
        <div class="hud__progress">
          <div class="hud__progress-bar" data-progress></div>
        </div>
      </footer>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
    <script type="module" src="main.js"></script>
  </body>
</html>
