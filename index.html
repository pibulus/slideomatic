<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Slide-o-Matic</title>
    <meta
      name="description"
      content="Slideomatic.app ‚Äî voice-powered, pastel-punk slideshow engine. Launch a deck, start fresh, or upload your own JSON."
    />
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <main class="landing">
      <section class="landing__hero">
        <p class="landing__eyebrow">Pastel-punk presentation lab</p>
        <h1 class="landing__title">Slide-o-Matic</h1>
        <p class="landing__subtitle">
          Kick off the default deck, dive straight into the editor, or drop in a JSON export. Slideomatic.app keeps the neon-soaked,
          voice-ready tooling within reach.
        </p>
        <div class="landing__actions">
          <a class="button button--primary" href="deck.html">Open default deck</a>
          <a class="button button--secondary" href="admin.html">Start new deck</a>
          <button class="button button--accent" type="button" id="upload-btn">Upload deck JSON</button>
          <input type="file" id="upload-input" accept=".json,application/json" hidden />
        </div>
      </section>

      <section class="landing__grid" id="about">
        <article class="landing__panel">
          <h2>Pastel-punk slides, zero build steps.</h2>
          <p>
            Slide-o-Matic bundles a live deck runtime, a JSON editor, and a theme drawer. Swap art direction with a dropdown, edit
            slides while you present, or let Gemini draft new pages from voice prompts.
          </p>
        </article>

        <div class="landing__cards">
          <article class="landing__card">
            <h3>Voice-first workflow</h3>
            <p>Hold <strong>V</strong> or <strong>E</strong> inside the deck to add or edit slides by speaking ‚Äî AI fills in the JSON.</p>
          </article>
          <article class="landing__card">
            <h3>Theme everything</h3>
            <p>Open the theme drawer to randomize palettes, prompt Gemini for a new vibe, or save presets to your local library.</p>
          </article>
          <article class="landing__card">
            <h3>JSON you can trust</h3>
            <p>Download the deck at any time. The editor validates against the schema so your exports stay portable.</p>
          </article>
        </div>
      </section>
    </main>

    <footer class="landing__footer">
      <div class="landing__footer-about">
        <strong>About Slide-o-Matic</strong>
        <p>
          A pastel-punk, neo-brutalist deck machine by
          <a href="https://bento.me/pibulus" target="_blank" rel="noopener">Pablo</a>. Designed for flow-state storytelling, rapid
          prototyping, and on-stage theme swaps without build tooling.
        </p>
        <div class="landing__footer-buttons">
          <button class="link-button" type="button" data-about-open>Read the origin story</button>
          <a class="link-button link-button--kofi" href="https://ko-fi.com/pibulus" target="_blank" rel="noopener">‚òï Support on Ko-fi</a>
        </div>
      </div>
      <div class="landing__footer-actions">
        <button class="link-button" type="button" data-open-intent="theme">Open theme drawer</button>
        <button class="link-button" type="button" data-open-intent="settings">Open settings</button>
        <a class="link-button" href="README.md" target="_blank" rel="noopener">Docs</a>
      </div>
    </footer>

    <div class="about-modal" id="about-modal" aria-hidden="true">
      <div class="about-modal__backdrop" data-about-close></div>
      <article class="about-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="about-modal-title" tabindex="-1">
        <button class="about-modal__close" type="button" aria-label="Close about" data-about-close>√ó</button>
        <h2 class="about-modal__title" id="about-modal-title">Slide-o-Matic</h2>
        <p class="about-modal__lede">
          Slide-o-Matic is a pastel-punk slideshow laboratory for people who ship stories fast. It pairs a JSON-first editor with voice
          tooling so you can improvise slides, remix themes, and push exports without breaking flow.
        </p>
        <ul class="about-modal__list">
          <li>üéôÔ∏è Voice commands draft and edit slides mid-presentation.</li>
          <li>üé® Theme drawer flips palettes, gradients, and typography live.</li>
          <li>üì¶ JSON exports stay schema-safe and portable between decks.</li>
        </ul>
        <p class="about-modal__footer">
          Built by <a href="https://bento.me/pibulus" target="_blank" rel="noopener">Pablo Alvarado</a>. If it sparks joy, grab a deck,
          remix a theme, and share the vibe.
        </p>
      </article>
    </div>

    <script type="module">
      const uploadBtn = document.getElementById('upload-btn');
      const uploadInput = document.getElementById('upload-input');
      const actionButtons = document.querySelectorAll('[data-open-intent]');
      const aboutModal = document.getElementById('about-modal');
      const aboutDialog = aboutModal?.querySelector('.about-modal__dialog');
      const aboutOpeners = document.querySelectorAll('[data-about-open]');
      const aboutClosers = aboutModal?.querySelectorAll('[data-about-close]');
      let aboutPreviousFocus = null;

      uploadBtn?.addEventListener('click', () => uploadInput?.click());

      uploadInput?.addEventListener('change', (event) => {
        const file = event.target.files?.[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = () => {
          try {
            JSON.parse(reader.result);
          } catch (error) {
            alert('That file is not valid JSON. Please pick a deck JSON export.');
            return;
          }

          const objectUrl = URL.createObjectURL(file);
          const target = new URL('deck.html', window.location.href);
          target.searchParams.set('slides', objectUrl);
          target.searchParams.set('open', 'theme');
          window.location.href = target.toString();
        };

        reader.onerror = () => {
          alert('Unable to read that file. Please try again.');
        };

        reader.readAsText(file);
      });

      actionButtons.forEach((button) => {
        button.addEventListener('click', () => {
          const intent = button.dataset.openIntent;
          const target = new URL('deck.html', window.location.href);
          if (intent) {
            target.searchParams.set('open', intent);
          }
          window.location.href = target.toString();
        });
      });

      function openAboutModal() {
        if (!aboutModal || aboutModal.classList.contains('is-open')) return;
        aboutPreviousFocus = document.activeElement instanceof HTMLElement ? document.activeElement : null;
        aboutModal.classList.add('is-open');
        aboutModal.setAttribute('aria-hidden', 'false');
        requestAnimationFrame(() => aboutDialog?.focus({ preventScroll: true }));
        document.addEventListener('keydown', handleAboutKeydown, true);
      }

      function closeAboutModal() {
        if (!aboutModal || !aboutModal.classList.contains('is-open')) return;
        aboutModal.classList.remove('is-open');
        aboutModal.setAttribute('aria-hidden', 'true');
        document.removeEventListener('keydown', handleAboutKeydown, true);
        const target = aboutPreviousFocus && typeof aboutPreviousFocus.focus === 'function'
          ? aboutPreviousFocus
          : null;
        aboutPreviousFocus = null;
        requestAnimationFrame(() => target?.focus());
      }

      function handleAboutKeydown(event) {
        if (event.key === 'Escape') {
          event.preventDefault();
          closeAboutModal();
        }
        if (event.key !== 'Tab') return;
        if (!aboutDialog) return;
        const focusable = aboutDialog.querySelectorAll(
          'a[href], button:not([disabled]), textarea, input:not([disabled]):not([type="hidden"]), select:not([disabled]), [tabindex]:not([tabindex="-1"])'
        );
        if (focusable.length === 0) {
          event.preventDefault();
          aboutDialog.focus({ preventScroll: true });
          return;
        }

        const first = focusable[0];
        const last = focusable[focusable.length - 1];
        if (!event.shiftKey && document.activeElement === last) {
          event.preventDefault();
          first.focus();
        } else if (event.shiftKey && document.activeElement === first) {
          event.preventDefault();
          last.focus();
        }
      }

      aboutOpeners.forEach((button) => button.addEventListener('click', openAboutModal));
      aboutClosers?.forEach((button) => button.addEventListener('click', closeAboutModal));
    </script>
  </body>
</html>
